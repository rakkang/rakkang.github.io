<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Ruikye"><meta name="description" content="ssh-keyssh-key是用于用于认证Github账户的密钥，从Github通过Git下载开源项目时要求账户添加了ssh-key。如果gitclone时账户没有添加ssh-key则会在命令行出现下面的错误提示:1234$gitclonehttp"><meta name="keywords" content="Github"><title>Github ssh-key 与 deploy key · Ruikye</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://ruikye.com/2016/10/19/github-ssh-keys/"><link rel="alternate" href="/atom.xml" title="Ruikye"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"></head><body><div id="main"><header><a href="/." class="logo">Ruikye</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Catalog</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">Github ssh-key 与 deploy key</h1><span class="post-time">2016年10月19日</span><div id="sidebar" class="post-sidebar"><h3 class="heading">目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh-key"><span class="toc-text">ssh-key</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成-ssh-key"><span class="toc-text">生成 ssh-key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加-ssh-key"><span class="toc-text">添加 ssh-key</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deploy-key"><span class="toc-text">deploy key</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成-deploy-key"><span class="toc-text">生成 deploy key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加-deploy-key"><span class="toc-text">添加 deploy key</span></a></li></ol></li></ol></div><div class="post-content"><h2 id="ssh-key"><a href="#ssh-key" class="headerlink" title="ssh-key"></a>ssh-key</h2><p>ssh-key 是用于用于认证 Github 账户的密钥，从 Github 通过 Git 下载开源项目时要求账户添加了 ssh-key。如果 <code>git clone</code> 时账户没有添加 ssh-key 则会在命令行出现下面的错误提示:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/npsabari/testrepo.git</div><div class="line">Cloning into <span class="string">'testRepo'</span>...</div><div class="line">Permission denied (publickey).</div><div class="line">fatal: The remote end hung up unexpectedly</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="生成-ssh-key"><a href="#生成-ssh-key" class="headerlink" title="生成 ssh-key"></a>生成 ssh-key</h3><blockquote>
<p>示例的操作都是在 Mac 执行的</p>
</blockquote>
<p>打开 <code>终端</code>，使用 <code>ssh-keygen</code> 命令生成 ssh-key<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ ssh-keygen</div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</div><div class="line">Enter same passphrase again:</div><div class="line">Your identification has been saved <span class="keyword">in</span> /Users/kang/.ssh/test.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /Users/kang/.ssh/test.pub.</div><div class="line">The key fingerprint is:</div><div class="line">SHA256:Z//9gcDS40LheYjxpZOuDgbG5wRQ9X7O7BTXfo134es kang@ruikye</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line">+---[RSA 2048]----+</div><div class="line">| .....           |</div><div class="line">|  .   .          |</div><div class="line">|   .   o . .     |</div><div class="line">|  . . . = X .    |</div><div class="line">|   + o oS&amp;oB . . |</div><div class="line">|  . =   BoB.+ o.o|</div><div class="line">|     +   B ..o.++|</div><div class="line">|    . . + .  ..o+|</div><div class="line">|      .o .    oE+|</div><div class="line">+----[SHA256]-----+</div></pre></td></tr></table></figure></p>
<h3 id="添加-ssh-key"><a href="#添加-ssh-key" class="headerlink" title="添加 ssh-key"></a>添加 ssh-key</h3><p>默认生成的 ssh-key 公钥在 <code>~/.ssh/id_rsa.pub</code> 文件，复制公钥上传到 Github。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 复制 ssh 公钥</span></div><div class="line">$ cat ~/.ssh/id_rsa.pub | pbcopy</div></pre></td></tr></table></figure></p>
<p>在 Github 的账户设置中，打开 <code>SSH and GPG keys</code> -&gt; <code>New SSH key</code> 添加复制的 <code>~/.ssh/id_rsa.pub</code> 公钥</p>
<h2 id="deploy-key"><a href="#deploy-key" class="headerlink" title="deploy key"></a>deploy key</h2><p>deploy key 每个 Repository 都有一个，主要用于 push 代码时使用。每个 Repo 的 deploy key 都是单独设置的，不能多个 Repo 使用相同的 deploy key。如果 Repository 没有添加 deploy key 时直接 push 代码，会出现权限错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ git push origin master</div><div class="line">Permission denied (publickey).</div><div class="line">fatal: Could not write to remote repository.</div><div class="line"></div><div class="line">Please make sure you have the correct access rights</div><div class="line">and the repository exists.</div></pre></td></tr></table></figure></p>
<h3 id="生成-deploy-key"><a href="#生成-deploy-key" class="headerlink" title="生成 deploy key"></a>生成 deploy key</h3><p>deploy key 和 ssh key 本质是一样的，都可以用 <code>ssh-keygen</code> 命令生成。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ ssh-keygen <span class="_">-f</span> ~/.ssh/deploy_key_repo1</div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</div><div class="line">Enter same passphrase again:</div><div class="line">Your identification has been saved <span class="keyword">in</span> /Users/kang/.ssh/test.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /Users/kang/.ssh/test.pub.</div><div class="line">The key fingerprint is:</div><div class="line">SHA256:Z//9gcDS40LheYjxpZOuDgbG5wRQ9X7O7BTXfo134es kang@ruikye</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line">+---[RSA 2048]----+</div><div class="line">| .....           |</div><div class="line">|  .   .          |</div><div class="line">|   .   o . .     |</div><div class="line">|  . . . = X .    |</div><div class="line">|   + o oS&amp;oB . . |</div><div class="line">|  . =   BoB.+ o.o|</div><div class="line">|     +   B ..o.++|</div><div class="line">|    . . + .  ..o+|</div><div class="line">|      .o .    oE+|</div><div class="line">+----[SHA256]-----+</div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong><em>注意：</em></strong> 因为在生成 ssh-key 使用了默认 id_rsa.pub 文件存储，所以 deploy key 要放在其他的文件中。</p>
</blockquote>
<p>由于 deploy key 不是放在默认文件，所以 deploy key 不能直接使用，需要添加到<code>SSL</code>的认证列表中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 添加默认的 id_rsa</span></div><div class="line">$ ssh-add ~/.ssh/id_rsa</div><div class="line"></div><div class="line"><span class="comment"># 添加 deploy key</span></div><div class="line">$ ssh-add ~/.ssh/deploy_key_repo1</div><div class="line"></div><div class="line"><span class="comment"># 查看所有 add 的 keys</span></div><div class="line">$ ssh-add <span class="_">-l</span></div><div class="line">2048 SHA256:kqQTYy......dsp+8 /Users/your/.ssh/id_rsa (RSA)</div><div class="line">2048 SHA256:0b/vdS......62tok /Users/your/.ssh/deploy_key_repo1 (RSA)</div></pre></td></tr></table></figure>
<h3 id="添加-deploy-key"><a href="#添加-deploy-key" class="headerlink" title="添加 deploy key"></a>添加 deploy key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 复制 deploy key</span></div><div class="line">$ cat ~/.ssh/deploy_key_repo1.pub | pbcopy</div></pre></td></tr></table></figure>
<p>打开 Repository 的设置页，在 <code>Deploy keys</code> -&gt; <code>Add deploy key</code> 添加公钥并勾选 <code>Allow write access</code>。</p>
</div></article><div class="tags"><a href="/tags/Github/">Github</a></div><div class="paginator"><a href="/2016/10/13/github-domain-bind/" class="next"><span>下一页</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://ruikye.com/2016/10/19/github-ssh-keys/';
    this.page.identifier = '2016/10/19/github-ssh-keys/';
    this.page.title = 'Github ssh-key 与 deploy key';
};
(function() {
var d = document, s = d.createElement('script');

s.src = '//ruikye.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Ruikye</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>